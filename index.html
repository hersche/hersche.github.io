<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
    <script src="http://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.9.0/jquery-ui.min.js"></script>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />
    <title>skamster.github.io</title>
    <script type="text/javascript">
        HTTP_GET_VARS = new Array();
        strGET = document.location.search.substr(1, document.location.search.length);
        if (strGET != '') {
            gArr = strGET.split('&');
            for (i = 0; i < gArr.length; ++i) {
                v = '';
                vArr = gArr[i].split('=');
                if (vArr.length > 1) {
                    v = vArr[1];
                }
                HTTP_GET_VARS[unescape(vArr[0])] = unescape(v);
            }
        }

        function updateContent() {
            $.getJSON("en.json")
                .done(function(data) {
                    jData = jQuery.parseJSON(JSON.stringify(data));
                    if (typeof(Storage) !== "undefined") {
                        localStorage.removeItem("jData");
                        localStorage.jData = JSON.stringify(data);
                    }
                    $("#showContent").html(processHtml(jData, lastName));

                })
                .fail(function(jqxhr, textStatus, error) {
                    alert("Request failed: " + error);
                    console.log("Request Failed: " + error);
                });


        }

        function GET(v) {
            if (!HTTP_GET_VARS[v]) {
                return 'undefined';
            }
            return HTTP_GET_VARS[v];
        }

        function processHtml(jDataIn, name) {
            var displayHtml = "";
            $.each(jDataIn, function(key, val) {
                var site = jQuery.parseJSON(JSON.stringify(val));
                if (name == key) {
                    if (key == "index") {
                        displayHtml += "<h1>" + val.title + "</h1><p>" + val.description + "</p><table><tr><th>Projectname</th><th>Source</th>";
                        displayHtml += "<th>Docs</th><th>Stability</th></tr>";
                        $.each(val.content, function(cKey, cVal) {
                            displayHtml += '<tr><td><a href="index.html?s=' + cKey + '" onclick="changeContent(\'' + cKey + '\'); return false;" >' + cKey + '</a></td><td><a href="' + cVal.pLink + '" >Project</a></td><td><a href="' + cVal.sLink + '">Src</a></td>';
                            displayHtml += "<td><a href='" + cVal.dLink + "'>Doc</a></td><td>" + cVal.stable + "</td></tr>";
                        });
                    } else if (key == "about") {
                        displayHtml += '<p><img src="' + val.picture + '"/><br />' + val.description + '</p><ul>';
                        $.each(val.contact, function(cKey, cVal) {
                            displayHtml += '<li><b>' + cKey + '</b>: ' + cVal + '</li>';
                        });
                        displayHtml += '</ul>';
                    } else {
                        displayHtml += "<h1>" + key + "</h1><p>" + val.preword + "</p>";
                        displayHtml += "<h3>Features</h3><ul>";
                        $.each(val.features, function(fKey, fVal) {
                            displayHtml += "<li>" + fKey + ": " + fVal + "</li>";
                        });
                        displayHtml += "</ul><h3>Pictures</h3><ul>";
                        $.each(val.pictures, function(pKey, pVal) {
                            displayHtml += "<li>" + pVal.desc+":<br /> <a href='"+pVal.link+"'><img src='" + pVal.src + "' /></a></li>";
                        });
                                                displayHtml += "</ul><h3>Bugs</h3><ul>";
                        $.each(val.bugs, function(bKey, bVal) {
                            displayHtml += "<li>" + bKey+": " + bVal + "</li>";
                        });
                        displayHtml += "</ul><p>" + val.description + "</p>";
                    }
                }
            });
            return displayHtml;
        }

        var lastName = "";
        var jData;
        $(document).ready(function() {
            if (GET('s') != 'undefined' & GET('s') != 'index') {
                lastName = GET('s');
            } else {
                lastName = "index";
            }

            var items = [];
            if (typeof(Storage) !== "undefined") {
                // Code for localStorage/sessionStorage.
                if (localStorage.jData) {
                    jData = jQuery.parseJSON(localStorage.jData);
                    $("#showContent").html(processHtml(jData, lastName));
                } else {
                    //retrive

                    $.getJSON("en.json")
                        .done(function(data) {
                            localStorage.jData = JSON.stringify(data);
                            jData = data;
                            $("#showContent").html(processHtml(jData, lastName));
                        })
                        .fail(function(jqxhr, textStatus, error) {
                            alert("(with webstorage) Request failed: " + error);
                            console.log("Request Failed: " + error);
                        });
                }
            } else {
                // Sorry! No Web Storage support..
                $.getJSON("en.json")
                    .done(function(data) {
                        jData = jQuery.parseJSON(JSON.stringify(data));
                        $("#showContent").html(processHtml(jData, lastName));
                    })
                    .fail(function(jqxhr, textStatus, error) {
                        alert("(withouth webstorage) Request failed: " + error);
                        console.log("Request Failed: " + error);
                    });

            }
            //alert(JSON.stringify(jData));
            //alert(displayHtml);

            $("#showContent").fadeIn(1000);
            $("#menu").fadeIn(1000);

        });

        function changeContent(name) {
            if (history.pushState) {
                history.pushState({
                    "id": 100
                }, "skamster.github.io::" + name, "index.html?s=" + name);
            }
            if (name != lastName) {
                $("#animationContainer").effect("slide", {
                    "direction": "left",
                    "mode": "hide"
                }, 400, function() {
                    $("#showContent").html(processHtml(jData, name));

                });

                $("#animationContainer").effect("slide", {
                    "direction": "right",
                    "mode": "show"
                }, 400);
                lastName = name;
            }

            return false;
        }
    </script>
</head>

<body>
    <header>
        <div class="container" style="display: none;" id="menu">
            <div id="menucontent">
                <h1>skamster.github.io</h1>
                <section id="downloads">
                    <a style="margin-left:5px;" href="index.html?s=index" onclick="changeContent('index'); return false" class="btn fade">Home</a>
                    <a href="index.html?s=about" onclick="changeContent('about'); return false" class="btn fade">About me</a>
                    <a href="#" onclick="updateContent(); return false" class="btn fade">Refresh</a>
                    <a target="_blank" href="https://github.com/skamster" class="btn btn-github fade">
                        <span class="icon"></span>View on GitHub</a>
                </section>
            </div>
        </div>
    </header>
    <div id="animationContainer">
        <div id="showContent" style="display: none"></div>
    </div>

</body>

</html>